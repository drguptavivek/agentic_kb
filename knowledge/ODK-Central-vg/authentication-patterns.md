---
domain: ODK-Central-vg
type: reference
status: approved
tags: #odk #vg-fork #authentication #bearer-token #field-key #basic-auth
created: 2026-01-28
---

# ODK Central Authentication Patterns

> **Source**: `docs/vg/vg-server/routes/authentication-patterns.md`

## Overview

ODK Central supports multiple authentication mechanisms:
1. **Cookie Authentication** - Web UI sessions
2. **Bearer Token** - App user authentication (short-lived)
3. **Field Key** - ODK Collect (URL-based token delivery)
4. **Basic Auth** - Direct email/password (slow, discouraged)
5. **Anonymous** - Public endpoints (login, OIDC, test)

## Key Insight

**Bearer Token and Field Key are the SAME token system** - only the delivery method differs:
- Bearer: `Authorization: Bearer <token>` header
- Field Key: URL path `/key/<token>` or query `?st=<token>`

Both use `Sessions.getByBearerToken()` for validation.

## Token Format

- 64-character alphanumeric string
- Validated by: `/^[A-Za-z0-9!$]{64}$/`
- Stored in: `sessions.token` column
- Generated by: `generateToken()` in `server/lib/util/crypto.js`

## Authentication Types

### 1. Cookie Authentication (Web UI)

**Used by**: Browser users

**Cookie attributes**:
```javascript
{
  name: '__Host-session',  // HTTPS
  httpOnly: true,
  secure: true,
  sameSite: 'Strict'
}
```

**CSRF token**: Separate `__csrf` cookie

**TTL**: 24 hours (configurable via `SESSION_LIFETIME`)

**Lockout**: 5 failures/5min → 10min lock

### 2. Bearer Token Authentication

**Used by**: Mobile app users (data collectors)

**Delivery**: `Authorization: Bearer <token>` header

**Code path**: `server/lib/http/preprocessors.js:62-65`

**TTL**: 3 days (configurable via `vg_app_user_session_ttl_days`)

**Cap**: 3 sessions (configurable via `vg_app_user_session_cap`)

**Endpoints**:
- `POST /v1/projects/:id/app-users/login` - Get token
- `POST /v1/.../submissions` - Submit data
- `GET /v1/.../submissions` - List submissions
- `PATCH /v1/.../submissions/:id` - Update submission

### 3. Field Key Authentication (Same Token, URL Delivery)

**Used by**: ODK Collect (OpenROSA/OData)

**Delivery patterns**:
- Query-based: `/v1/projects/1/formList?st=<token>` (common)
- Path-based: `/v1/key/<token>/projects/1/formList` (deprecated)

**Code path**: `server/lib/http/preprocessors.js:38-60`

**Actor restriction**: Only `field_key` or `public_link` types

**Error code**: 403 (not 401) for invalid tokens

**Endpoints**:
- `GET /v1/projects/:id/formList`
- `GET /v1/.../forms/:id/manifest`
- `POST /v1/.../submission`
- `GET /v1/.../forms/:id.svc/*`

### 4. Basic Authentication

**Used by**: Scripts, automation (discouraged)

**Delivery**: `Authorization: Basic <base64(email:password)>`

**Important**: Does NOT create a session - authenticates every request with bcrypt

**Performance**: Very slow (hundreds of ms per request)

**Disabled when**: OIDC is enabled

**HTTPS only**: Enforced by server

### 5. Anonymous Access

**Public endpoints**:
- `POST /v1/sessions` - Web user login (self-authenticating)
- `POST /v1/projects/:id/app-users/login` - App user login
- `POST /v1/users/reset/initiate` - Password reset start
- `POST /v1/users/reset/verify` - Password reset verify
- `GET/POST /v1/oidc/*` - OIDC SSO flow
- `GET/POST /v1/test/:key/...` - Draft form testing

## Session Security Comparison

| Aspect | Web User (Cookie) | App User (Bearer/Field Key) |
|--------|------------------|----------------------------|
| **TTL** | 24 hours | 3 days (configurable) |
| **Cap** | None | 3 sessions (configurable) |
| **Lockout** | 5/5min → 10min | 20/15min → 30min (IP) + 5/5min → 10min (user+IP) |
| **Storage** | `sessions` table | `sessions` table |
| **Token format** | Cookie value | 64-char string |

## Security Headers

### Cookie Attributes
```
Set-Cookie: __Host-session=<token>; HttpOnly; Secure; SameSite=Strict; Path=/
Set-Cookie: __csrf=<token>; HttpOnly; Secure; SameSite=Strict; Path=/
```

### CSRF Headers
```
X-Requested-With: XMLHttpRequest
# Or POST body: __csrf=<token>
```

### Authorization Headers
```
# Bearer token
Authorization: Bearer ABCDEF123456789...64chars...XYZ

# Basic auth
Authorization: Basic am9obkBleGFtcGxlLmNvbTpwYXNzd29yZA==
```

## Related Documentation

- [[ODK-Central-vg/odk-central-vg-overview]] - Main overview
- [[ODK-Central-vg/app-user-api]] - App user endpoints
- [[ODK-Central-vg/security-controls]] - Lockout and rate limiting
